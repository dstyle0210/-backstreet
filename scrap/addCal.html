<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <title>Document</title>
</head>
<body>
제목 : <input type="text" name="" id="title">
상세 : <input type="text" name="" id="desc">
장소 : <input type="text" name="" id="lod">

<script>
    $(function(){
    // 네이버 API 예제 - 캘린더 일정 추가하기
    var token = sessionStorage.getItem("ntoken");
    var header = "Bearer " + token; // Bearer 다음에 공백 추가
    var calSum =  "[제목] 캘린더API로 추가한 일정";
    var calDes =  "[상세] 회의 합니다";
    var calLoc =  "[장소] 그린팩토리";
    var uid = token.substring(0, 15);// UUID 생성 (임시로 일단 토큰값을 잘라서 사용)
    var scheduleIcalString = "BEGIN:VCALENDAR\n"
    scheduleIcalString += "VERSION:2.0\n"
    scheduleIcalString += "PRODID:Naver Calendar\n"
    scheduleIcalString += "CALSCALE:GREGORIAN\n"
    scheduleIcalString += "BEGIN:VTIMEZONE\n"
    scheduleIcalString += "TZID:Asia/Seoul\n"
    scheduleIcalString += "BEGIN:STANDARD\n"
    scheduleIcalString += "DTSTART:19700101T000000\n"
    scheduleIcalString += "TZNAME:GMT+:00\n"
    scheduleIcalString += "TZOFFSETFROM:+0900\n"
    scheduleIcalString += "TZOFFSETTO:+0900\n"
    scheduleIcalString += "END:STANDARD\n"
    scheduleIcalString += "END:VTIMEZONE\n"
    scheduleIcalString += "BEGIN:VEVENT\n"
    scheduleIcalString += "SEQUENCE:0\n"
    scheduleIcalString += "CLASS:PUBLIC\n"
    scheduleIcalString += "TRANSP:OPAQUE\n"
    scheduleIcalString += "UID:" + uid + "\n"                            // 일정 고유 아이디
    scheduleIcalString += "DTSTART;TZID=Asia/Seoul:20170123T120000\n"     // 시작 일시
    scheduleIcalString += "DTEND;TZID=Asia/Seoul:20170123T133000\n"      // 종료 일시
    scheduleIcalString += "SUMMARY:" + calSum + " \n"                     // 일정 제목
    scheduleIcalString += "DESCRIPTION:" + calDes + " \n"                 // 일정 상세 내용
    scheduleIcalString += "LOCATION:" + calLoc + " \n"                   // 장소
    // scheduleIcalString += "RRULE:FREQ=YEARLY;BYDAY=FR;INTERVAL=1;UNTIL=20201231\n" +  // 일정 반복시 설정
    scheduleIcalString += "ORGANIZER;CN=마봉아빠:mailto:webstandard@naver.com\n"  // 일정 만든 사람
    // scheduleIcalString += "ATTENDEE;ROLE=REQ-PARTICIPANT;PARTSTAT=NEEDS-ACTION;CN=admin:mailto:user1@sample.com\n"  // 참석자
    scheduleIcalString += "CREATED:20170123T120000\n"          // 일정 생성시각
    scheduleIcalString += "LAST-MODIFIED:20170123T120000\n"   // 일정 수정시각
    scheduleIcalString += "DTSTAMP:20170123T120000\n"          // 일정 타임스탬프
    scheduleIcalString += "END:VEVENT\n";
    scheduleIcalString += "END:VCALENDAR";

    var options = {
        url: "https://openapi.naver.com/calendar/createSchedule.json",
        form: {'calendarId':'defaultCalendarId', 'scheduleIcalString':scheduleIcalString},
        headers: {'Authorization': header}
    };
    $.ajax(options,function (error, response, body) {
        if (!error && response.statusCode == 200) {
            alert("성공");
            res.writeHead(200, {'Content-Type': 'text/json;charset=utf-8'});
            res.end(body);
        } else {
            alert("실패");
            console.log('error');
            if(response != null) {
                res.status(response.statusCode).end();
                console.log('error = ' + response.statusCode);
            }
        }
    });
    })
</script>
</body>
</html>